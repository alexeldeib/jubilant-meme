{
    "builders": [
      {
        "type": "azure-arm",
        "subscription_id": "{{user `subscription`}}",
        "virtual_network_resource_group_name": "nodesigtest-agent-pool",
        "virtual_network_name": "nodesig-pool-vnet",
        "virtual_network_subnet_name": "packer",
        "ssh_timeout": "3h",
        "os_type": "Linux",
        "os_disk_size_gb": 512,
        "azure_tags": {
          "SkipLinuxAzSecPack": "true",
          "os": "Linux",
          "createdBy": "aks-vhd-pipeline"
        },
        "location": "eastus",
        "vm_size": "Standard_D4ads_v5",
        "polling_duration_timeout": "1h"
      }
    ],
    "provisioners": [
      {
        "type": "file",
        "source": "scripts/install-sudo.sh",
        "destination": "/home/packer/install-sudo.sh"
      },
      {
        "type": "file",
        "source": "scripts/image-deps.sh",
        "destination": "/home/packer/image-deps.sh"
      },
      {
        "type": "file",
        "source": "artifacts.tar.gz",
        "destination": "/home/packer/artifacts.tar.gz"
      },
      {
        "type": "shell",
        "inline": [
          "/bin/bash -ux /home/packer/image-deps.sh"
        ]
      },
      {
        "type": "shell",
        "inline": [
          "sudo /bin/bash -ux /home/packer/image-deps.sh"
        ]
      },
      {
        "type": "shell",
        "inline": [
          "sudo /usr/sbin/waagent -force -deprovision+user",
          "export HISTSIZE=0 && sync"
        ]
      }
    ]
}